<!DOCTYPE html>
<html lang="pt">
<head>
        <meta charset="utf-8" />
        <title>Blog do Bla - Programação</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Blog do Bla </a></h1>
                <nav><ul>
                    <li><a href="/category/controle-de-versao.html">Controle de Versão</a></li>
                    <li class="active"><a href="/category/programacao.html">Programação</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/medindo-tempo-de-execucao.html">Medindo tempo de execução</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-07-21T01:39:00-03:00">
                Published: Thu 21 July 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/bla.html">Bla</a>
        </address>
<p>In <a href="/category/programacao.html">Programação</a>.</p>
<p>tags: <a href="/tag/python.html">Python</a> <a href="/tag/otimizacao.html">Otimização</a> <a href="/tag/shell.html">Shell</a> <a href="/tag/profiling.html">Profiling</a> <a href="/tag/bash.html">Bash</a> <a href="/tag/linux.html">Linux</a> </p>
</footer><!-- /.post-info --><p>No último <a href="/acelerando-fibonacci-com-cache.html">post</a> falei um pouco sobre como
usar fibonacci para melhorar o desempenho do fibonacci recursivo. Os gráficos que
gerei foram feitos usando <a href="http://www.gnuplot.info/">Gnuplot</a>.</p>
<p>Como queria uma quantidade significativa de dados para estes gráficos, não tinha
como gerá-los manualmente. Precisava automatizar.</p>
<p>Já havia usado a ferramenta <code>time</code>, uma utilidade oferecida pelo
<a href="https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29"><code>bash</code></a>, mas tive
dificuldade em formatar a saída, que tem a seguinte forma:</p>
<div class="highlight"><pre><span></span>bla@notebook:~$ <span class="nb">time</span> python3 fibonacci.py 25
real    0m0.064s
user    0m0.056s
sys     0m0.008s
</pre></div>


<p>Depois de várias buscas na internet descobri que existe um programa externo ao
<code>bash</code> também chamado <code>time</code> que também mede o tempo de execução e aceita
operadores de formato. O programa está instalado em <code>/usr/bin/</code> (pelo menos no
meu notebook com <a href="https://www.debian.org/">Debian</a>) e, embora este diretório
faça parte da variável de ambiente <code>PATH</code>, é ofuscado pelo <code>time</code> do <code>bash</code>.
Para usá-lo então tive que invocar usando o caminho para o arquivo. Por preferência
pessoal usei o caminho absoluto (<code>/usr/bin/time</code>).</p>
<p>A saída do <code>/usr/bin/time</code> é no formato:</p>
<div class="highlight"><pre><span></span>bla@notebook:~$ /usr/bin/time python3 fibonacci.py 25
0.06user 0.00system 0:00.06elapsed 95%CPU <span class="o">(</span>0avgtext+0avgdata 7724maxresident<span class="o">)</span>k
0inputs+0outputs <span class="o">(</span>0major+865minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<p>Como estava interessado apenas no tempo total usado (<em>elapsed</em> na saída acima),
pude usar uma string de formato bem simples para pegar apenas este campo.</p>
<div class="highlight"><pre><span></span>bla@notebook:~$ /usr/bin/time -f <span class="s2">&quot;%E&quot;</span> python3 fibonacci.py 25
0:00.06
</pre></div>


<p>Para remover a parte dos minutos (antes do <code>:</code>) e ter a saída como um número
facilmente interpretável usei o programa <a href="https://pt.wikipedia.org/wiki/Cut_%28Unix%29"><code>cut</code></a>.
No caso em questão bastou determinar o delimitador de campos como <code>:</code> e o campo
de interesse como 2.</p>
<div class="highlight"><pre><span></span>bla@notebook:~$ /usr/bin/time -f <span class="s2">&quot;%E&quot;</span> python3 fibonacci.py <span class="m">25</span> <span class="p">|</span> cut -d: -f2
0:00.07
</pre></div>


<p>Isso não foi exatamente como desejado. O que está acontecendo aqui é que o <code>|</code>
está redirecionando o <a href="https://pt.wikipedia.org/wiki/Fluxos_padr%C3%A3o#Sa.C3.ADda_padr.C3.A3o_.28stdout.29"><code>stdout</code></a>
do comando anterior a ele para o
<a href="https://pt.wikipedia.org/wiki/Fluxos_padr%C3%A3o#Entrada_padr.C3.A3o_.28stdin.29"><code>stdin</code></a>
do <code>cut</code>, mas o <code>/usr/bin/time</code> não imprime no <code>stdout</code> e sim no
<a href="https://pt.wikipedia.org/wiki/Fluxos_padr%C3%A3o#Erro_padr.C3.A3o_.28stderr.29"><code>stderr</code></a>!
Uma forma de contornar este problema é redirecionar o <code>stderr</code> para o <code>stdout</code>.
Felizmente a sintaxe de script do <code>bash</code> nos permite fazer isto facilmente.
A saída padrão (<code>stdout</code>) é representada como <code>1</code> e a saída de err (<code>stderr</code>) é
representada como <code>2</code>. Para redirecionar o <code>stderr</code> para o <code>stdout</code> podemos usar
<code>2&gt;&amp;1</code>. É possível fazer o contrário também (redirecionar <code>stdout</code> para <code>stderr</code>)
usando <code>1&gt;&amp;2</code>. Então, usando a primeira forma, atingimos o resultado esperado.</p>
<div class="highlight"><pre><span></span>/usr/bin/time -f <span class="s2">&quot;%E&quot;</span> python3 fibonacci.py <span class="m">25</span> 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> cut -d: -f2
00.05
</pre></div>


<p>Para testar o tempo de execução <code>fibonacci.py</code> para vários números bastava colocar
tudo isto num laço e jogar a saída em um arquivo.</p>
<div class="highlight"><pre><span></span>bla@notebook:~$ <span class="k">for</span> n in <span class="o">{</span>1..5<span class="o">}</span>
&gt; <span class="k">do</span>
&gt; /usr/bin/time -f <span class="s2">&quot;%E&quot;</span> python3 fibonacci.py <span class="nv">$n</span> 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> cut -d: -f2 &gt; tempos.txt
&gt; <span class="k">done</span>
00.02
00.02
00.02
00.02
00.02
</pre></div>


<p>Foi assim que gerei os dados dos gráficos do post anterior. Desde então tenho me
perguntado se esta é a solução mais pythônica. Acredito que não, é excessivamente
complexo. Então comecei a mexer no código para que não precisasse fazer todo esse
malabarismo com o shell.</p>
<h2>Medindo tempo com python</h2>
<p>A tarefa de medir o tempo de execução de pedaços de código é geralmente parte do
processo de <em>profiling</em>, que visa detectar gargalos de desempenho. Como este
processo é bastante usado, também são as subtarefas que o compõe. Medir o tempo
de execução não é exceção.</p>
<p>Como toda (ou pelo menos quase toda) linguagem de programação, python oferece um
módulo para trabalhar com medidas de tempo na biblioteca padrão. A função
<a href="https://docs.python.org/3/library/time.html?highlight=time.time#time.time"><code>time</code></a>
(pertencente ao módulo de mesmo nome) retorna a quantidade de segundos passados
desde <a href="https://en.wikipedia.org/wiki/Unix_time"><em>epoch</em></a> (1 de janeiro de 1970).
Esta representação de tempo popular é também conhecida como <em>Unix time</em>.</p>
<p>Com esta função é possível medir o tempo de execução de trechos de código facilmente.
Por exemplo:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">slow_func</span><span class="p">():</span>
    <span class="c1"># Função de interesse</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">tempo_inicial</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">slow_func</span><span class="p">()</span>
<span class="n">tempo_final</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">tempo_total</span> <span class="o">=</span> <span class="n">tempo_final</span> <span class="o">-</span> <span class="n">tempo_inicial</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;{:.3f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tempo_total</span><span class="p">))</span>
</pre></div>


<p>Este código já pode ser usado dentro de um laço para gerar todos os tempos no
formato desejado de uma forma mais limpa que apresentada anteriormente mas, será
que pode ficar melhor?</p>
<p>Sim! Usando um decorator podemos tornar este código mais reutilizável e pythônico!</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">functools</span>


<span class="k">def</span> <span class="nf">_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">temporizador</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>

    <span class="n">functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">tempo_inicio</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tempo_fim</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">tempo_total</span> <span class="o">=</span> <span class="n">tempo_fim</span> <span class="o">-</span> <span class="n">tempo_inicio</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;{} executou em: {:.3f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fim</span> <span class="o">-</span> <span class="n">inicio</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@temporizador</span>
<span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>


<p>Assumindo que o código acima está no arquivo <code>fibonacci_com_decorator.py</code> podemos
usá-lo no prompt interativo da seguinte forma:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">fibonacci_com_decorator</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fibonacci</span> <span class="n">executou</span> <span class="n">em</span><span class="p">:</span> <span class="mf">0.000</span><span class="n">s</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fibonacci</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="n">fibonacci</span> <span class="n">executou</span> <span class="n">em</span><span class="p">:</span> <span class="mf">0.053</span><span class="n">s</span>
<span class="mi">75025</span>
</pre></div>


<p>Foi necessário adicionar um <em>wrapper</em> para a função fibonacci devido a sua natureza
recursiva. Se o decorator fosse aplicado à função recursiva os tempos de execução
de todas as chamadas recursivas seriam mostrados.</p>
<p>O ponto mais interessante é que este método permite medir o desempenho de diferentes
partes do código executando-o apenas uma vez. Além disto, os dados de performance
podem ser usados em logs, permitindo que a aplicação seja analisada sem ser
interrompida.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/acelerando-fibonacci-com-cache.html" rel="bookmark"
                           title="Permalink to Acelerando Fibonacci com cache">Acelerando Fibonacci com cache</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-17T17:27:00-03:00">
                Published: Sun 17 July 2016
        </abbr>
		<br />
        <abbr class="modified" title="2016-07-19T22:35:00-03:00">
                Updated: Tue 19 July 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/bla.html">Bla</a>
        </address>
<p>In <a href="/category/programacao.html">Programação</a>.</p>
<p>tags: <a href="/tag/python.html">Python</a> <a href="/tag/cache.html">Cache</a> <a href="/tag/programacao-dinamica.html">Programação Dinâmica</a> </p>
</footer><!-- /.post-info -->                <h2>Programação Dinâmica</h2>
<p>No campo de teoria da computação é comum ouvir o termo <em>Programação Dinâmica</em>.
Pessoalmente achei bastante difícil entender este conceito. Todos os
lugares que procurava via exemplos usando matrizes, o que deixava o
código bastante confuso. Finalmente, depois de algumas semanas, entendi
do que se tratava.</p>
<p>Programação dinâmica ...</p>
                <a class="readmore" href="/acelerando-fibonacci-com-cache.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/construindo-um-range-de-floats.html" rel="bookmark"
                           title="Permalink to Construindo um range de floats">Construindo um range de floats</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-17T00:28:00-03:00">
                Published: Sun 17 July 2016
        </abbr>
		<br />
        <abbr class="modified" title="2016-07-19T22:37:00-03:00">
                Updated: Tue 19 July 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/bla.html">Bla</a>
        </address>
<p>In <a href="/category/programacao.html">Programação</a>.</p>
<p>tags: <a href="/tag/python.html">Python</a> </p>
</footer><!-- /.post-info -->                <p>Há algumas semanas tive que implementar alguns algoritmos de inteligência
artificial para um trabalho da faculdade. Acabei fazendo alguns códigos
que talvez sejam úteis para outras pessoas, então decidi compartilhá-los.</p>
<p>Obs: Todos os códigos deste artigo foram testados em Python 3.4.</p>
<h2>Um <code>range</code> de <code>float</code>'s</h2>
<p>Uma das (sub ...</p>
                <a class="readmore" href="/construindo-um-range-de-floats.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/nathan-cruz77">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-77554989-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = 'https://ssl.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>